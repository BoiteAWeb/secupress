var SecuPress={supportButtonColor:"#F1C40F",swal2Defaults:{confirmButtonText:SecuPressi18nScanner.confirmText,cancelButtonText:SecuPressi18nScanner.cancelText,type:"warning",allowOutsideClick:!0,customClass:"wpmedia-swal2 secupress-swal2"},swal2ConfirmDefaults:{showCancelButton:!0,closeOnConfirm:!1}};jQuery(document).ready(function(a){function b(){var b;j&&window.Chart&&SecuPressi18nChart&&(a.isEmptyObject(i)?(b=[{value:SecuPressi18nChart.good.value,color:"#26B3A9",highlight:"#2BCDC1",label:SecuPressi18nChart.good.text,status:"good"},{value:SecuPressi18nChart.bad.value,color:"#CB234F",highlight:"#F2295E",label:SecuPressi18nChart.bad.text,status:"bad"},{value:SecuPressi18nChart.warning.value,color:"#F7AB13",highlight:"#F1C40F",label:SecuPressi18nChart.warning.text,status:"warning"}],SecuPressi18nChart.notscannedyet.value&&b.push({value:SecuPressi18nChart.notscannedyet.value,color:"#5A626F",highlight:"#888888",label:SecuPressi18nChart.notscannedyet.text,status:"notscannedyet"}),a.each(j,function(c,d){var e=d.id;i[e]=new Chart(d.getContext("2d")).Doughnut(b,{animationEasing:"easeInOutQuart",showTooltips:!0,segmentShowStroke:!1,percentageInnerCutout:90,tooltipEvents:["mousemove"],customTooltips:function(){}}),d.onclick=function(b){var c=i[e].getSegmentsAtEvent(b);c[0]&&a("#secupress-type-filters").find(".secupress-big-tab-"+c[0].status).find("a").trigger("click.secupress")}})):a.each(j,function(a,b){var c=b.id;i[c].segments[0].value=SecuPressi18nChart.good.value,i[c].segments[1].value=SecuPressi18nChart.bad.value,i[c].segments[2].value=SecuPressi18nChart.warning.value,"undefined"!=typeof i[c].segments[3]&&(i[c].segments[3].value=SecuPressi18nChart.notscannedyet.value),i[c].update()}),SecuPressi18nChart.notscannedyet.value||a(".secupress-chart-legend .status-notscannedyet").remove())}function c(a,b){a.bad?b.find(".secupress-big-tab-bad a").trigger("click.secupress"):a.warning?b.find(".secupress-big-tab-warning a").trigger("click.secupress"):a.good&&b.find(".secupress-big-tab-good a").trigger("click.secupress")}function d(b){b.each(function(){var b=a(this),c=this.nodeName.toLowerCase();"button"===c||"input"===c?b.attr({disabled:"disabled","aria-disabled":"true"}):b.addClass("disabled").attr("aria-disabled","true")})}function e(b){b.each(function(){var b=a(this),c=this.nodeName.toLowerCase();"button"===c||"input"===c?b.removeAttr("disabled aria-disabled"):b.removeClass("disabled").removeAttr("aria-disabled")})}function f(a){var b=a.get(0).nodeName.toLowerCase();return"button"===b||"input"===b?a.prop("disabled"):void a.hasClass("disabled")}function g(d){var e;j&&window.Chart&&(a(".secupress-chart-container .letter").replaceWith(d.letter),a(".secupress-score-text").text(d.text),a(".secupress-scan-infos .secupress-score").html(d.subtext),a("#wp-admin-bar-secupress").find(".letter").text(d.grade),a("#toplevel_page_"+SecuPressi18nScanner.pluginSlug+"_scanners").find(".update-count").text(d.bad).parent().attr("class",function(a,b){return b.replace(/count-\d+/,"count-"+d.bad)}),SecuPressi18nChart&&(SecuPressi18nChart.good.value=d.good,SecuPressi18nChart.bad.value=d.bad,SecuPressi18nChart.warning.value=d.warning,SecuPressi18nChart.notscannedyet.value=d.notscannedyet,b()),e=a("#secupress-type-filters"),e.find("a").each(function(){var b=a(this),c=b.data("type");b.children(".secupress-tab-subtitle").text(d[c+"-text"])}),d.notscannedyet?a(".secupress-count-notscannedyet").text(d.notscannedyet):(e.children(".secupress-big-tab-notscannedyet").children("a").hasClass("secupress-current")&&c(d,e),e.children(".secupress-big-tab-notscannedyet").remove()),d.hasaction?(e.children(".secupress-big-tab-hasaction").removeClass("hidden").removeAttr("aria-hidden"),d.isBulk&&e.find(".secupress-big-tab-hasaction a").trigger("click.secupress")):(e.children(".secupress-big-tab-hasaction").children("a").hasClass("secupress-current")&&c(d,e),e.children(".secupress-big-tab-hasaction").addClass("hidden").attr("aria-hidden",!0)),"A"===d.grade?a("#tweeterA").slideDown():a("#tweeterA").slideUp())}function h(b){var c;SecuPressi18nScanner.i18nNonce&&(c={action:"secupress-get-scan-counters",_wpnonce:SecuPressi18nScanner.i18nNonce},a.getJSON(ajaxurl,c).done(function(c){a.isPlainObject(c)&&c.success&&c.data&&(c.data.isBulk=b,g(c.data))}))}var i={},j=[],k=0;document.getElementById("status_chart")&&j.push(document.getElementById("status_chart")),document.getElementById("status_chart_mini")&&j.push(document.getElementById("status_chart_mini")),function(a,b,c,d){function e(a,b,d,f){c.getJSON(a).done(function(g){return g.success?g.data&&(f.text(g.data+"%"),100!==g.data)?void e(a,b,d,f):void b.closest(".secupress-notice").fadeTo(100,0,function(){c(this).slideUp(100,function(){c(this).remove()})}):(d.replaceWith('<span class="secupress-error-notif">'+SecuPressi18nScanner.error+"</span>"),void f.remove())}).fail(function(){d.replaceWith('<span class="secupress-error-notif">'+SecuPressi18nScanner.error+"</span>"),f.remove()})}c(".secupress-centralize-blog-options").on("click.secupress keyup",function(a){var b,d,f,g;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=c(this),d=b.attr("href").replace("admin-post.php","admin-ajax.php"),f=c('<img src="'+SecuPressi18nScanner.spinnerUrl+'" alt="" class="secupress-spinner" />'),g=c('<span class="secupress-ajax-percent">0%</span>'),b.hasClass("running")?!1:(b.addClass("running").parent().append(f).append(g).find(".secupress-error-notif").remove(),a.preventDefault(),void e(d,b,f,g))):!1})}(window,document,a),j&&window.Chart&&(a(".secupress-scanners-header").hasClass("secupress-not-scanned-yet")||b(),a(".secupress-chart-legend").find("li").on("click.secupress",function(){a("#secupress-type-filters").find(".secupress-big-tab-"+a(this).data("status")).find("a").trigger("click.secupress")})),function(a,b,c,d){c("#secupress-type-filters").find("a").on("click.secupress keyup",function(a){var b,d,e="active";return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=c(this),b.hasClass(e)?!1:(d=b.data("type"),b.closest("ul").find("a").removeClass(e),b.addClass(e),void c(".status-all").addClass("hidden").attr("aria-hidden",!0).filter(".status-"+d).removeClass("hidden").attr("aria-hidden",!1))):!1}).filter(".secupress-current").trigger("click.secupress")}(window,document,a),function(a,b,c,d){c("#secupress-priority-filters").find("input").on("change.secupress",function(a){var b=c(this),d=b.attr("name");return b.is(":checked")?c(".secupress-table-prio-"+d).spFadeIn():c(".secupress-table-prio-"+d).spHide(),!1})}(window,document,a),function(a,b,c,d){c(".secupress-ask-support-free").on("click.secupress keyup",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),void swal2(c.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:SecuPressi18nScanner.supportTitle,confirmButtonText:SecuPressi18nScanner.supportButton,html:SecuPressi18nScanner.supportContentFree,confirmButtonColor:SecuPress.supportButtonColor,type:"question"})).then(function(a){!0===a&&swal2(c.extend({},SecuPress.swal2Defaults,{title:"Pro Version needed",type:"error",showCancelButton:!0,confirmButtonText:"Get Pro now!",confirmButtonColor:SecuPress.supportButtonColor,reverseButtons:!0}))})):!1})}(window,document,a),function(a,b,c,d){c(".secupress-ask-support-pro").on("click.secupress keyup",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),void swal2(c.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:SecuPressi18nScanner.supportTitle,confirmButtonText:SecuPressi18nScanner.supportButton,html:SecuPressi18nScanner.supportContentPro,confirmButtonColor:SecuPress.supportButtonColor,type:"question"})).then(function(a){!0===a&&(swal2.enableLoading(),c.post(ajaxurl,{},null,"json").done(function(a){}).fail(function(){}))})):!1})}(window,document,a),function(a,c,g,i){function j(){g(".secupress-caroupoivre").each(function(){var a,b,c,d=g(this);if(0!==d.next(".secupress-caroupoivre-pagination").length)return!0;for(b=d.find(".secupress-slide[id]").length,c='<div class="secupress-caroupoivre-pagination">',a=0;b>a;a++)c+='<span class="secupress-dot"></span>';c+="</div>",d.after(c)})}function l(a){var c,d,e=g(".secupress-one-click-scanning-slideshow"),f=g(".secupress-caroupoivre"),h=g(".secupress-caroupoivre-pagination").find(".secupress-dot"),i=a.closest(".secupress-not-scanned-yet").length;i?g(".secupress-before-caroupoivre").fadeOut(200,function(){e.fadeIn(200)}):(g(".secupress-tabs-contents").hide(),e.fadeIn(200)),f.find(".secupress-slide").hide(),c=g(".secupress-slide-"+Math.floor(2*Math.random()+1)).html(),f.find("#secupress-slide1").html(c),d=setInterval(function(){return k++,k>=55?f.find("#secupress-slide2").is(":visible")||(f.find("#secupress-slide1").hide(),f.find("#secupress-slide2").fadeIn(275),h.removeClass("current").eq(1).addClass("current")):k>=0&&(f.find("#secupress-slide1").fadeIn(275),h.removeClass("current").eq(0).addClass("current")),!g.isEmptyObject(M.doingScan)&&k>90&&100>k?void(k=90):(k=Math.min(k,100),g(".secupress-progressbar").find(".secupress-progressbar-val").css("width",k+"%").find(".secupress-progress-val-txt").text(k+" %"),void(k>=100&&(k=0,clearInterval(d),e.fadeOut(200,function(){g(".secupress-scanners-header.secupress-not-scanned-yet").removeClass("secupress-not-scanned-yet"),g(".secupress-tabs-contents").show(),g("#secupress-l-scan").trigger("click.secupress"),i&&b()}))))},100)}function m(a){var b=a.match(/[&?]test=([^&]+)(?:$|&)/);return b?b[1]:!1}function n(a){return a.hasClass("status-bad")&&!a.hasClass("not-fixable")}function o(a){var b,c=!1;return b=a.attr("class").replace(/(\s|^)(status-error|status-all|status-hasaction)(\s|$)/g," ").replace(/^\s+|\s+$/g,"").replace(/\s+/," ").split(" "),g.each(b,function(a,b){return 0===b.indexOf("status-")?(c=b.substr(7),!1):void 0}),c}function p(a,b){a.removeClass("status-error status-good status-bad status-warning status-notscannedyet status-cantfix").addClass("status-"+b)}function q(a,b){a.find(".secupress-status-text").html(b)}function r(a,b){a.find(".secupress-scan-message").html(b)}function s(a){var b='<span class="dashicons dashicons-no secupress-dashicon" aria-hidden="true"></span> '+SecuPressi18nScanner.error;return q(a,b),r(a,""),a.addClass("status-error"),!1}function t(a,b){a.find(".secupress-fix-status-text").html(b)}function u(a,b){a.find(".secupress-fix-result-message").html(b)}function v(){swal2(g.extend({},SecuPress.swal2Defaults,{title:SecuPressi18nScanner.error,type:"error"}))}function w(a,b){var c='<span class="dashicons dashicons-no secupress-dashicon" aria-hidden="true"></span> '+SecuPressi18nScanner.error;return t(a,c),u(a,""),a.find(".secupress-fix-result").addClass("status-error"),b&&v(),!1}function x(a,b){return a.success&&g.isPlainObject(a.data)&&a.data.status&&a.data["class"]&&a.data.message?!0:s(b)}function y(a,b,c){return c=i===c?!1:c,a.success&&g.isPlainObject(a.data)&&a.data["class"]&&a.data.message?!0:w(b,c)}function z(a,b){var c,d=g("#"+b);return x(a,d)?(c=o(d),p(d,a.data["class"]),q(d,a.data.status),r(d,a.data.message),!0):!1}function A(a){return a.form_contents&&a.form_fields||a.manualFix}function B(a,b,c){var d=g("#"+b);d.find(".secupress-fix-result");return c=i===c?!1:c,y(a,d,c)?(A(a.data)?d.addClass("status-hasaction"):d.removeClass("status-hasaction"),t(d,a.data.status),u(d,a.data.message),!0):!1}function C(){return g.isEmptyObject(M.doingScan)&&g.isEmptyObject(M.doingFix)&&!M.delayedFixes.length}function D(a){var b=g("#secupress-latest").find(".secupress-reports-list");b.children(".secupress-empty").remove(),5===b.children("li").length?b.children("li:last").slideUp(250,function(){g(this).remove(),b.prepend(a).find("li.hidden").slideDown(250)}):b.prepend(a).find("li.hidden").slideDown(250)}function E(a){C()&&g("body").trigger("allScanDone.secupress",[{isBulk:a}])}function F(a,b,c,d){return a?void(M.doingScan[a]||(M.doingScan[a]=1,b.addClass("scanning").removeClass("status-error"),g.getJSON(c.replace("admin-post.php","admin-ajax.php")).done(function(e){z(e,a)?(delete M.doingScan[a],b.hasClass("autoscan")&&(b.removeClass("autoscan"),"good"===e.data["class"]&&b.find(".secupress-fix-result").html("")),g("body").trigger("scanDone.secupress",[{test:a,href:c,isBulk:d,data:e.data}])):delete M.doingScan[a]}).fail(function(){delete M.doingScan[a],s(b)}).always(function(){b.removeClass("scanning"),E(d)}))):(s(b),E(d))}function G(a){g.isEmptyObject(M.doingFix)&&!M.delayedFixes.length&&(a&&g(".secupress-fixit").removeClass("disabled"),g("body").trigger("allFixDone.secupress",[{isBulk:a}]))}function H(a,b,c,d){if(!a)return w(b,!d),G(d);if(!M.doingFix[a]){if(!d&&!g.isEmptyObject(M.doingFix))return!1;if(!n(b))return G(d);g(".secupress-fixit").addClass("disabled"),M.doingFix[a]=1,b.addClass("fixing").removeClass("status-error"),g.getJSON(c.replace("admin-post.php","admin-ajax.php")).done(function(b){B(b,a,!d)?(delete M.doingFix[a],A(b.data)&&(M.manualFix[a]=b.data),g("body").trigger("fixDone.secupress",[{test:a,href:c,isBulk:d,manualFix:A(b.data),data:b.data}])):delete M.doingFix[a]}).fail(function(){delete M.doingFix[a],w(b,!d)}).always(function(){b.removeClass("fixing"),d||g(".secupress-fixit").removeClass("disabled"),G(d)})}}function I(a){var b=a?"bulk":"",c=M.delayedFixes.shift();g(c).trigger(b+"fix.secupress")}function J(a){return g.isEmptyObject(M.doingFix)?(a.filter(".delayed-fix").each(function(){M.delayedFixes.push(this)}),a.not(".delayed-fix")):a}function K(a){return a.length<2?void a.trigger("fix.secupress"):(a=J(a),void(a.length?a.trigger("bulkfix.secupress"):I(!0)))}function L(a){var b,c,d="",e="info";c=M.manualFix[a],delete M.manualFix[a],c.message=c.message.replace(/(<ul>|<li>|<\/li><\/ul>)/g,"").replace(/<\/li>/g,"<br/>"),"bad"!==c["class"]&&"warning"!==c["class"]||(d+='<div class="sa-error-container show"><div class="icon">!</div><p>'+c.message+"</p></div>",e="bad"===c["class"]?"error":"warning"),d+='<form method="post" id="form_manual_fix" class="secupress-swal2-form show-input" action="'+ajaxurl+'">';for(b in c.form_contents)c.form_contents.hasOwnProperty(b)&&(d+=c.form_contents[b]);d+=c.form_fields,d+="</form>",swal2(g.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:c.form_title,html:d,type:e,confirmButtonText:SecuPressi18nScanner.fixit})).then(function(b){var c,d;b&&(swal2.enableLoading(),c=g("#form_manual_fix").serializeArray(),d=g("#"+a),g.post(ajaxurl,c,null,"json").done(function(b){B(b,a,!0)?A(b.data)?(M.manualFix[a]=b.data,L(a)):g("body").trigger("manualFixDone.secupress",[{test:a,data:b.data}]):w(d,!0)}).fail(function(){w(d,!0)}))})}var M={doingScan:{},doingFix:{},delayedFixes:[],manualFix:{}};j(),g("body").on("scanDone.secupress",function(a,b){var c=g("#"+b.test);M.delayedFixes.length&&I(b.isBulk),"good"===b.data["class"]&&(t(c,""),u(c,"")),""!==b.data.fix_msg&&u(c,b.data.fix_msg),c.find(".secupress-scanit .text").text(SecuPressi18nScanner.reScan)}),g("body").on("allScanDone.secupress",function(a,b){var c,d=g(".button-secupress-scan").last();f(d)?(c={action:"secupress-update-oneclick-scan-date",_wpnonce:d.data("nonce")},g.getJSON(ajaxurl,c).done(function(a){g.isPlainObject(a)&&a.success&&a.data&&D(a.data)}).always(function(){e(g(".button-secupress-scan")),h(b.isBulk)})):h(b.isBulk)}),g("body").on("fixDone.secupress",function(a,b){var c=g("#"+b.test),d=b.isBulk?"bulk":"";c.find(".secupress-scanit").trigger(d+"scan.secupress"),b.data["class"]&&!b.manualFix?c.addClass("has-fix-status").removeClass("no-fix-status"):c.addClass("no-fix-status").removeClass("has-fix-status")}),g("body").on("allFixDone.secupress",function(a,b){var c,d="",e=0;g.isEmptyObject(M.manualFix)||(g.each(M.manualFix,function(a,b){M.manualFix.hasOwnProperty(a)&&(c=a,++e,d+=",."+a)}),d=d.substr(1),d=g(d).children(".secupress-scan-result"),d.children(".manual-fix-message").remove(),d.append('<div class="manual-fix-message">'+SecuPressi18nScanner.manualFixMsg+"</div>"),b.isBulk?swal2(g.extend({},SecuPress.swal2Defaults,{title:1===e?SecuPressi18nScanner.oneManualFix:SecuPressi18nScanner.someManualFixes})):L(c),M.manualFix={})}),g("body").on("manualFixDone.secupress",function(a,b){var c=g("#"+b.test),d=SecuPressi18nScanner.notFixed,e="error";g("#"+b.test).find(".secupress-scanit").trigger("scan.secupress"),b.data["class"]?c.addClass("has-fix-status").removeClass("no-fix-status"):c.addClass("no-fix-status").removeClass("has-fix-status"),"warning"===b.data["class"]?(d=SecuPressi18nScanner.fixedPartial,e="warning"):"good"===b.data["class"]&&(d=SecuPressi18nScanner.fixed,e="success"),swal2(g.extend({},SecuPress.swal2Defaults,{title:d,html:b.data.message.replace(/(<ul>|<li>|<\/li><\/ul>)/g,"").replace(/<\/li>/g,"<br/><br/>"),type:e}))}),g("body").on("click.secupress keyup",".secupress-details",function(a){var b;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=g(this).data("test"),void swal2(g.extend({},SecuPress.swal2Defaults,{title:SecuPressi18nScanner.scanDetails,html:g("#details-"+b).find(".details-content").html(),type:"info"}))):!1}),g("body").on("click.secupress keyup",".secupress-details-fix",function(a){var b;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=g(this).data("test"),void swal2(g.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:SecuPressi18nScanner.fixDetails,confirmButtonText:SecuPressi18nScanner.fixit,reverseButtons:!0,html:g("#details-fix-"+b).find(".details-content").html(),type:"info"})).then(function(a){a&&(g("#"+b).find(".secupress-fixit").trigger("click.secupress"),swal2.close())})):!1}),g("body").on("click.secupress scan.secupress bulkscan.secupress keyup",".secupress-scanit",function(a){var b,c,d,e,f;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),b=g(this),c=b.attr("href"),d=m(c),e=b.closest(".secupress-item-"+d),f="bulkscan"===a.type,void F(d,e,c,f)):!1}),g("body").on("click.secupress bulkscan.secupress keyup",".button-secupress-scan",function(a){var b;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=g(this),void(f(b)||(a.preventDefault(),d(g(".button-secupress-scan")),g(".secupress-scanit").trigger("bulkscan.secupress"),l(b)))):!1}),g("body").on("click.secupress fix.secupress bulkfix.secupress keyup",".secupress-fixit",function(a){var b,c,d,e,f;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),b=g(this),c=b.attr("href"),d=m(c),e=b.closest(".secupress-item-"+d),f="bulkfix"===a.type,void H(d,e,c,f)):!1}),g("body").on("click.secupress keyup",".secupress-retry-fixit",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),void g(this).closest(".secupress-item-all").find(".secupress-fixit").trigger("fix.secupress")):!1}),g("body").on("click.secupress bulkfix.secupress keyup",".button-secupress-fix",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),K(g(".secupress-fixit")),void l(g(this))):!1}),g(".secupress-item-all.autoscan .secupress-scanit").trigger("bulkscan.secupress"),SecuPressi18nScanner.firstOneClickScan&&C()&&g(".button-secupress-scan").last().trigger("bulkscan.secupress")}(window,document,a)});