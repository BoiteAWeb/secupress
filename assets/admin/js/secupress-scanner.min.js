var SecuPress={supportButtonColor:"#F1C40F",swal2Defaults:{confirmButtonText:SecuPressi18nScanner.confirmText,cancelButtonText:SecuPressi18nScanner.cancelText,type:"warning",allowOutsideClick:!0,customClass:"wpmedia-swal2 secupress-swal2"},swal2ConfirmDefaults:{showCancelButton:!0,closeOnConfirm:!1}};jQuery(document).ready(function(a){function b(a){wp.a11y&&wp.a11y.speak&&void 0!==a&&a&&wp.a11y.speak(a)}function c(){var b;j&&window.Chart&&SecuPressi18nChart&&(a.isEmptyObject(i)?(b=[{value:SecuPressi18nChart.good.value,color:"#26B3A9",highlight:"#2BCDC1",label:SecuPressi18nChart.good.text,status:"good"},{value:SecuPressi18nChart.bad.value,color:"#CB234F",highlight:"#F2295E",label:SecuPressi18nChart.bad.text,status:"bad"},{value:SecuPressi18nChart.warning.value,color:"#F7AB13",highlight:"#F1C40F",label:SecuPressi18nChart.warning.text,status:"warning"}],SecuPressi18nChart.notscannedyet.value&&b.push({value:SecuPressi18nChart.notscannedyet.value,color:"#5A626F",highlight:"#888888",label:SecuPressi18nChart.notscannedyet.text,status:"notscannedyet"}),a.each(j,function(a,c){var d=c.id;i[d]=new Chart(c.getContext("2d")).Doughnut(b,{animationEasing:"easeInOutQuart",showTooltips:!0,segmentShowStroke:!1,percentageInnerCutout:93,tooltipEvents:[]})})):a.each(j,function(a,b){var c=b.id;i[c].segments[0].value=SecuPressi18nChart.good.value,i[c].segments[1].value=SecuPressi18nChart.bad.value,i[c].segments[2].value=SecuPressi18nChart.warning.value,"undefined"!=typeof i[c].segments[3]&&(i[c].segments[3].value=SecuPressi18nChart.notscannedyet.value),i[c].update()}),SecuPressi18nChart.notscannedyet.value||a(".secupress-chart-legend .status-notscannedyet").remove())}function d(b){b.each(function(){var b=a(this),c=this.nodeName.toLowerCase();"button"===c||"input"===c?b.attr({disabled:"disabled","aria-disabled":"true"}):b.addClass("disabled").attr("aria-disabled","true")})}function e(b){b.each(function(){var b=a(this),c=this.nodeName.toLowerCase();"button"===c||"input"===c?b.removeAttr("disabled aria-disabled"):b.removeClass("disabled").removeAttr("aria-disabled")})}function f(a){var b=a.get(0).nodeName.toLowerCase();return"button"===b||"input"===b?a.prop("disabled"):void a.hasClass("disabled")}function g(b){j&&window.Chart&&(a(".secupress-chart-container .letter").replaceWith(b.letter),a(".secupress-score-text").text(b.text),a(".secupress-scan-infos .secupress-score").html(b.subtext),a("#wp-admin-bar-secupress").find(".letter").text(b.grade),a("#toplevel_page_"+SecuPressi18nScanner.pluginSlug+"_scanners").find(".update-count").text(b.bad).parent().attr("class",function(a,c){return c.replace(/count-\d+/,"count-"+b.bad)}),SecuPressi18nChart&&(SecuPressi18nChart.good.value=b.good,SecuPressi18nChart.bad.value=b.bad,SecuPressi18nChart.warning.value=b.warning,SecuPressi18nChart.notscannedyet.value=b.notscannedyet,c()),"A"===b.grade?a("#tweeterA").slideDown():a("#tweeterA").slideUp())}function h(b){var c;SecuPressi18nScanner.i18nNonce&&(c={action:"secupress-get-scan-counters",_wpnonce:SecuPressi18nScanner.i18nNonce},a.getJSON(ajaxurl,c).done(function(c){a.isPlainObject(c)&&c.success&&c.data&&(c.data.isBulk=b,g(c.data))}))}var i={},j=[];document.getElementById("status_chart")&&j.push(document.getElementById("status_chart")),document.getElementById("status_chart_mini")&&j.push(document.getElementById("status_chart_mini")),function(a,b,c,d){var e=c(".secupress-start-one-click-scan").find(".button-secupress-scan");e.find(".secupress-progress-val-txt"),e.find(".secupress-progressbar-val");e.css("width",e.outerWidth()+5)}(window,document,jQuery),function(a,b,c,d){function e(a,b,d,f){c.getJSON(a).done(function(g){return g.success?g.data&&(f.text(g.data+"%"),100!==g.data)?void e(a,b,d,f):void b.closest(".secupress-notice").fadeTo(100,0,function(){c(this).slideUp(100,function(){c(this).remove()})}):(d.replaceWith('<span class="secupress-error-notif">'+SecuPressi18nScanner.error+"</span>"),void f.remove())}).fail(function(){d.replaceWith('<span class="secupress-error-notif">'+SecuPressi18nScanner.error+"</span>"),f.remove()})}c(".secupress-centralize-blog-options").on("click.secupress keyup",function(a){var b,d,f,g;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=c(this),d=b.attr("href").replace("admin-post.php","admin-ajax.php"),f=c('<img src="'+SecuPressi18nScanner.spinnerUrl+'" alt="" class="secupress-spinner" />'),g=c('<span class="secupress-ajax-percent">0%</span>'),b.hasClass("running")?!1:(b.addClass("running").parent().append(f).append(g).find(".secupress-error-notif").remove(),a.preventDefault(),void e(d,b,f,g))):!1})}(window,document,a),j&&window.Chart&&(a(".secupress-scanners-header").hasClass("secupress-not-scanned-yet")||c()),function(a,b,c,d){c(".secupress-ask-support-free").on("click.secupress keyup",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),void swal2(c.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:SecuPressi18nScanner.supportTitle,html:SecuPressi18nScanner.supportContentFree,confirmButtonColor:SecuPress.supportButtonColor,showCancelButton:!1,type:"question"})).then(function(a){return!0===a?void swal2.close():void 0})):!1})}(window,document,a),function(a,b,c,d){c(".secupress-ask-support-pro").on("click.secupress keyup",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),void swal2(c.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:SecuPressi18nScanner.supportTitle,confirmButtonText:SecuPressi18nScanner.supportButton,html:SecuPressi18nScanner.supportContentPro,confirmButtonColor:SecuPress.supportButtonColor,type:"question"})).then(function(a){!0===a&&(swal2.enableLoading(),c.post(ajaxurl,{},null,"json").done(function(a){}).fail(function(){}))})):!1})}(window,document,a),function(a,g,i,j){function k(){var a=i("#secupress-tests").find(".secupress-item-all").length;M.total=a}function l(a){var d,e=i(".secupress-introduce-first-scan"),f=a.closest(".secupress-not-scanned-yet").length,g=a.find(".secupress-progressbar-val"),h=g.find(".secupress-progress-val-txt"),j=2;e.addClass("secupress-scanning"),i(".secupress-scanned-total").text(M.total),d=setInterval(function(){var a=Object.keys(M.doingScan).length,k=M.total-a,l=Math.max(k/M.total*100,j);l=Math.round(Math.min(l,100)),g.css("width",l+"%"),h.text(l+" %"),i(".secupress-scanned-current").text(k),l>=100&&(b(SecuPressi18nScanner.a11y.scanEnded),clearInterval(d),e.slideUp(200,function(){i(".secupress-open-moreinfo").removeClass("secupress-activated"),i("#secupress-more-info").removeClass("secupress-open").hide(),i(".secupress-scan-header-main").css("display","flex").hide().slideDown(200,function(){i(".secupress-scanners-header.secupress-not-scanned-yet").removeClass("secupress-not-scanned-yet")}),f&&c()}))},500)}function m(a){var b=a.match(/[&?]test=([^&]+)(?:$|&)/);return b?b[1]:!1}function n(a){return a.hasClass("status-bad")&&!a.hasClass("not-fixable")}function o(a){var b,c=!1;return b=a.attr("class").replace(/(\s|^)(status-error|status-all|status-hasaction)(\s|$)/g," ").replace(/^\s+|\s+$/g,"").replace(/\s+/," ").split(" "),i.each(b,function(a,b){return 0===b.indexOf("status-")?(c=b.substr(7),!1):void 0}),c}function p(a,b){a.removeClass("status-error status-good status-bad status-warning status-notscannedyet status-cantfix").addClass("status-"+b)}function q(a,b){a.find(".secupress-item-status .secupress-label").text(b)}function r(a,b){a.find(".secupress-item-title").html(b)}function s(a){return q(a,SecuPressi18nScanner.error),r(a,""),a.addClass("status-error"),!1}function t(a,b){a.find(".secupress-fix-status-text").html(b)}function u(a,b){a.find(".secupress-fix-result-message").html(b)}function v(){swal2(i.extend({},SecuPress.swal2Defaults,{title:SecuPressi18nScanner.error,type:"error"}))}function w(a,b){var c='<span class="dashicons dashicons-no secupress-dashicon" aria-hidden="true"></span> '+SecuPressi18nScanner.error;return t(a,c),u(a,""),a.find(".secupress-fix-result").addClass("status-error"),b&&v(),!1}function x(a,b){return a.success&&i.isPlainObject(a.data)&&a.data.status&&a.data["class"]&&a.data.message?!0:s(b)}function y(a,b,c){return c=j===c?!1:c,a.success&&i.isPlainObject(a.data)&&a.data["class"]&&a.data.message?!0:w(b,c)}function z(a,b){var c,d=i("#"+b);return x(a,d)?(c=o(d),p(d,a.data["class"]),q(d,a.data.status),r(d,a.data.message),!0):!1}function A(a){return a.form_contents&&a.form_fields||a.manualFix}function B(a,b,c){var d=i("#"+b);d.find(".secupress-fix-result");return c=j===c?!1:c,y(a,d,c)?(A(a.data)?d.addClass("status-hasaction"):d.removeClass("status-hasaction"),t(d,a.data.status),u(d,a.data.message),!0):!1}function C(){return i.isEmptyObject(M.doingScan)&&i.isEmptyObject(M.doingFix)&&!M.delayedFixes.length}function D(a){var b=i("#secupress-latest").find(".secupress-reports-list");b.children(".secupress-empty").remove(),5===b.children("li").length?b.children("li:last").slideUp(250,function(){i(this).remove(),b.prepend(a).find("li.hidden").slideDown(250)}):b.prepend(a).find("li.hidden").slideDown(250)}function E(a){C()&&i("body").trigger("allScanDone.secupress",[{isBulk:a}])}function F(a,b,c,d){return a?void(M.doingScan[a]||(M.doingScan[a]=1,b.addClass("scanning").removeClass("status-error"),i.getJSON(c.replace("admin-post.php","admin-ajax.php")).done(function(e){z(e,a)?(delete M.doingScan[a],b.hasClass("autoscan")&&(b.removeClass("autoscan"),"good"===e.data["class"]&&b.find(".secupress-fix-result").html("")),i("body").trigger("scanDone.secupress",[{test:a,href:c,isBulk:d,data:e.data}])):delete M.doingScan[a]}).fail(function(){delete M.doingScan[a],s(b)}).always(function(){b.removeClass("scanning"),E(d)}))):(s(b),E(d))}function G(a){i.isEmptyObject(M.doingFix)&&!M.delayedFixes.length&&(a&&i(".secupress-fixit").removeClass("disabled"),i("body").trigger("allFixDone.secupress",[{isBulk:a}]))}function H(a,b,c,d){if(!a)return w(b,!d),G(d);if(!M.doingFix[a]){if(!d&&!i.isEmptyObject(M.doingFix))return!1;if(!n(b))return G(d);i(".secupress-fixit").addClass("disabled"),M.doingFix[a]=1,b.addClass("fixing").removeClass("status-error"),i.getJSON(c.replace("admin-post.php","admin-ajax.php")).done(function(b){B(b,a,!d)?(delete M.doingFix[a],A(b.data)&&(M.manualFix[a]=b.data),i("body").trigger("fixDone.secupress",[{test:a,href:c,isBulk:d,manualFix:A(b.data),data:b.data}])):delete M.doingFix[a]}).fail(function(){delete M.doingFix[a],w(b,!d)}).always(function(){b.removeClass("fixing"),d||i(".secupress-fixit").removeClass("disabled"),G(d)})}}function I(a){var b=a?"bulk":"",c=M.delayedFixes.shift();i(c).trigger(b+"fix.secupress")}function J(a){return i.isEmptyObject(M.doingFix)?(a.filter(".delayed-fix").each(function(){M.delayedFixes.push(this)}),a.not(".delayed-fix")):a}function K(a){return a.length<2?void a.trigger("fix.secupress"):(a=J(a),void(a.length?a.trigger("bulkfix.secupress"):I(!0)))}function L(a){var b,c,d="",e="info";c=M.manualFix[a],delete M.manualFix[a],c.message=c.message.replace(/<br\/>/g,"<br/><br />"),"bad"!==c["class"]&&"warning"!==c["class"]||(d+='<div class="sa-error-container show"><div class="icon">!</div><p>'+c.message+"</p></div>",e="bad"===c["class"]?"error":"warning"),d+='<form method="post" id="form_manual_fix" class="secupress-swal2-form show-input" action="'+ajaxurl+'">';for(b in c.form_contents)c.form_contents.hasOwnProperty(b)&&(d+=c.form_contents[b]);d+=c.form_fields,d+="</form>",swal2(i.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:c.form_title,html:d,type:e,confirmButtonText:SecuPressi18nScanner.fixit})).then(function(b){var c,d;b&&(swal2.enableLoading(),c=i("#form_manual_fix").serializeArray(),d=i("#"+a),i.post(ajaxurl,c,null,"json").done(function(b){B(b,a,!0)?A(b.data)?(M.manualFix[a]=b.data,L(a)):i("body").trigger("manualFixDone.secupress",[{test:a,data:b.data}]):w(d,!0)}).fail(function(){w(d,!0)}))})}var M={doingScan:{},doingFix:{},delayedFixes:[],manualFix:{},total:0};k(),i("body").on("scanDone.secupress",function(a,b){var c=i("#"+b.test);M.delayedFixes.length&&I(b.isBulk),"good"===b.data["class"]&&(t(c,""),u(c,"")),""!==b.data.fix_msg&&u(c,b.data.fix_msg),c.find(".secupress-scanit .text").text(SecuPressi18nScanner.reScan)}),i("body").on("allScanDone.secupress",function(a,b){var c,d=i(".button-secupress-scan").last();f(d)?(c={action:"secupress-update-oneclick-scan-date",_wpnonce:d.data("nonce")},i.getJSON(ajaxurl,c).done(function(a){i.isPlainObject(a)&&a.success&&a.data&&D(a.data)}).always(function(){e(i(".button-secupress-scan")),h(b.isBulk)})):h(b.isBulk)}),i("body").on("fixDone.secupress",function(a,b){var c=i("#"+b.test),d=b.isBulk?"bulk":"";c.find(".secupress-scanit").trigger(d+"scan.secupress"),b.data["class"]&&!b.manualFix?c.addClass("has-fix-status").removeClass("no-fix-status"):c.addClass("no-fix-status").removeClass("has-fix-status")}),i("body").on("allFixDone.secupress",function(a,b){var c,d="",e=0;i.isEmptyObject(M.manualFix)||(i.each(M.manualFix,function(a,b){M.manualFix.hasOwnProperty(a)&&(c=a,++e,d+=",."+a)}),d=d.substr(1),d=i(d).children(".secupress-scan-result"),d.children(".manual-fix-message").remove(),d.append('<div class="manual-fix-message">'+SecuPressi18nScanner.manualFixMsg+"</div>"),b.isBulk?swal2(i.extend({},SecuPress.swal2Defaults,{title:1===e?SecuPressi18nScanner.oneManualFix:SecuPressi18nScanner.someManualFixes})):L(c),M.manualFix={})}),i("body").on("manualFixDone.secupress",function(a,b){var c=i("#"+b.test),d=SecuPressi18nScanner.notFixed,e="error";i("#"+b.test).find(".secupress-scanit").trigger("scan.secupress"),b.data["class"]?c.addClass("has-fix-status").removeClass("no-fix-status"):c.addClass("no-fix-status").removeClass("has-fix-status"),"warning"===b.data["class"]?(d=SecuPressi18nScanner.fixedPartial,e="warning"):"good"===b.data["class"]&&(d=SecuPressi18nScanner.fixed,e="success"),swal2(i.extend({},SecuPress.swal2Defaults,{title:d,html:b.data.message.replace(/<br\/>/g,"<br/><br />"),type:e}))}),i("body").on("click.secupress keyup",".secupress-details",function(a){var b;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=i(this).data("test"),void swal2(i.extend({},SecuPress.swal2Defaults,{title:SecuPressi18nScanner.scanDetails,html:i("#details-"+b).find(".details-content").html(),type:"info"}))):!1}),i("body").on("click.secupress keyup",".secupress-details-fix",function(a){var b;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=i(this).data("test"),void swal2(i.extend({},SecuPress.swal2Defaults,SecuPress.swal2ConfirmDefaults,{title:SecuPressi18nScanner.fixDetails,confirmButtonText:SecuPressi18nScanner.fixit,reverseButtons:!0,html:i("#details-fix-"+b).find(".details-content").html(),type:"info"})).then(function(a){a&&(i("#"+b).find(".secupress-fixit").trigger("click.secupress"),swal2.close())})):!1}),i("body").on("click.secupress scan.secupress bulkscan.secupress keyup",".secupress-scanit",function(a){var b,c,d,e,f;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),b=i(this),c=b.attr("href"),d=m(c),e=b.closest(".secupress-item-"+d),f="bulkscan"===a.type,void F(d,e,c,f)):!1}),i("body").on("click.secupress bulkscan.secupress keyup",".button-secupress-scan",function(a){var b;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(b=i(this),void(f(b)||(a.preventDefault(),d(i(".button-secupress-scan")),i(".secupress-scanit").trigger("bulkscan.secupress"),l(b)))):!1}),i("body").on("click.secupress fix.secupress bulkfix.secupress keyup",".secupress-fixit",function(a){var b,c,d,e,f;return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),b=i(this),c=b.attr("href"),d=m(c),e=b.closest(".secupress-item-"+d),f="bulkfix"===a.type,void H(d,e,c,f)):!1}),i("body").on("click.secupress keyup",".secupress-retry-fixit",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),void i(this).closest(".secupress-item-all").find(".secupress-fixit").trigger("fix.secupress")):!1}),i("body").on("click.secupress bulkfix.secupress keyup",".button-secupress-fix",function(a){return"keyup"!==a.type||secupressIsSpaceOrEnterKey(a)?(a.preventDefault(),K(i(".secupress-fixit")),void l(i(this))):!1}),i(".secupress-item-all.autoscan .secupress-scanit").trigger("bulkscan.secupress"),SecuPressi18nScanner.firstOneClickScan&&C()&&i(".button-secupress-scan").last().trigger("bulkscan.secupress")}(window,document,a)});